<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notes - Nattsu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css?v=20251030">
  </head>
  <body>
    <main class="section">
      <div class="container">
        <h1 class="brand" style="margin-bottom:12px;">Notes</h1>
        <p style="margin:0 0 16px;"><a class="cta" href="./index.html">← ホームへ</a></p>
        <ul class="cards" id="notes-list"></ul>
      </div>
    </main>
    <script>
      async function fetchText(path) {
        const res = await fetch(path);
        if (!res.ok) throw new Error('Failed to fetch ' + path);
        return await res.text();
      }
      function markdownToHtml(md) {
        const lines = md.split(/\r?\n/);
        let html = '';
        let inCode = false;
        for (const line of lines) {
          if (line.startsWith('```')) { html += inCode ? '</code></pre>' : '<pre class="card"><code>'; inCode = !inCode; continue; }
          if (inCode) { html += line.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '\n'; continue; }
          if (line.startsWith('# ')) html += '<h4>' + line.slice(2) + '</h4>';
          else if (line.startsWith('## ')) html += '<h5>' + line.slice(3) + '</h5>';
          else if (line.trim().length === 0) {}
          else if (line.startsWith('- ')) html += '<p>' + line.replace(/^\-\s*/, '• ') + '</p>';
          else html += '<p>' + line + '</p>';
        }
        return html;
      }
      async function loadNotes() {
        const listEl = document.getElementById('notes-list');
        const res = await fetch('./notes/index.json?v=20251030');
        const manifest = await res.json();
        manifest.sort((a, b) => (a.date < b.date ? 1 : a.date > b.date ? -1 : a.title.localeCompare(b.title)));
        for (const item of manifest) {
          try {
            const md = await fetchText('./notes/' + item.file);
            const li = document.createElement('li');
            li.className = 'card';
            li.innerHTML = `
              <h4>${item.title}</h4>
              <p style="color: var(--muted); font-size: 12px; margin-top: -4px;">${item.date}${item.tags ? ' ・ ' + item.tags.join(', ') : ''}</p>
              <div>${markdownToHtml(md)}</div>
            `;
            listEl.appendChild(li);
          } catch (e) { console.error(e); }
        }
      }
      loadNotes();
    </script>
  </body>
  </html>

