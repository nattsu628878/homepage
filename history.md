# Homepage 開発履歴

## プロジェクト概要

一般的なサイトではなく、奇抜なUIのサイトを目指す。宇宙の星がコンテンツになっていて、星が自由に漂っているイメージを実現する。

## コンセプト

- **宇宙の星がコンテンツ**: 各コンテンツ（ページ、リンクなど）が星として表現される
- **星が自由に漂う**: 星が3D空間内を自由に動き回るアニメーション
- **星をクリックで遷移**: 星をクリックすると内部ページや外部リンクに遷移
- **他サイトへのリンクも星**: 外部リンクも星として表現

## 実装計画

### Phase 1: 星のシステム構築（現在）
- [x] history.mdの作成
- [x] 既存システムの刷新
- [x] 3D空間の実装（Three.js等を使用）
- [x] 星の生成と配置システム
- [x] 星のアニメーション（漂う動き）
- [x] 星のクリック検知と遷移機能

### Phase 2: コンテンツ統合
- [ ] Notesを星として表示
- [ ] Linksを星として表示
- [ ] 各星にラベル/ツールチップ表示
- [ ] 星のサイズや色でコンテンツタイプを区別

### Phase 3: 詳細ページ
- [ ] 星をクリックした際の詳細ページ表示
- [ ] 詳細ページから宇宙空間への戻り機能

### Phase 4: 拡張機能
- [ ] 星の検索機能
- [ ] 星のフィルタリング機能
- [ ] 星の軌道カスタマイズ
- [ ] パフォーマンス最適化

## 技術スタック

- **3Dレンダリング**: Three.js
- **アニメーション**: Three.js + requestAnimationFrame
- **HTML/CSS/JavaScript**: バニラJS（フレームワークは使用しない方針）

## 開発方針

- 既存のJekyllシステムは刷新し、シンプルなHTML/CSS/JavaScript構成に変更
- モダンなブラウザを前提とする（WebGL対応必須）
- パフォーマンスを重視し、星の数は適切に制限
- アクセシビリティも考慮（キーボード操作、スクリーンリーダー対応など）

## フォルダ構造

```
docs/
  stars/
    data.json      # 星のデータ（名前、URL、位置、色など）
    config.json    # 星の設定（タイプ、アニメーション、カメラなど）
  index.html       # メインページ（宇宙空間）
  notes.html       # ノート一覧ページ
  links.html       # リンク一覧ページ
  github.html      # GitHubページ
  youtube.html     # YouTubeページ
  twitter.html     # X(Twitter)ページ
  test1.html       # テストページ（例）
  ...
```

## 星の追加方法

### 1. 星のデータを追加

`docs/stars/data.json`に新しい星のエントリを追加します。

```json
{
  "id": "unique-id",
  "name": "星の名前",
  "url": "./target-page.html",
  "position": [x, y, z],
  "color": "0xrrggbb",
  "type": "page",
  "description": "説明文"
}
```

#### 各フィールドの説明

- **id**: 星の一意ID（必須、重複不可）
- **name**: 星に表示される名前（必須）
- **url**: クリック時の遷移先URL（必須）
  - 内部ページ: `"./page.html"` 形式
  - 外部リンク: `"https://example.com"` 形式
- **position**: 3D空間での位置 `[x, y, z]`（必須）
  - 例: `[20, 10, -10]` は x=20, y=10, z=-10 の位置
  - 他の星と重ならない位置を指定することを推奨
- **color**: 星の色（必須）
  - 16進数形式: `"0xffd700"`（金色）、`"0x00ffff"`（シアン）など
  - 色の参考: https://www.color-hex.com/
- **type**: 星のタイプ（必須）
  - `"page"`: 内部ページ
  - `"external"`: 外部リンク
  - `"note"`: ノート
  - `"planet"`: 惑星（衛星を持つ親星）
  - `"satellite"`: 衛星（親星の周りを回転する子星）
- **description**: 説明文（オプション、ホバー時に表示される）
- **parentId**: 親星のID（衛星の場合のみ必須）
  - 例: `"parentId": "links"` は "links" というIDの星を親とする
- **orbitRadius**: 軌道半径（衛星の場合のみ、デフォルト: 10）
  - 親星からの距離を指定
- **orbitSpeed**: 軌道速度（衛星の場合のみ、デフォルト: 0.5）
  - 回転の速さを指定（大きいほど速い）
- **orbitAngle**: 初期角度（衛星の場合のみ、デフォルト: 0）
  - リング上の初期位置を指定（ラジアン）

#### 追加例

**通常の星（ページ）**:
```json
{
  "id": "my-project",
  "name": "マイプロジェクト",
  "url": "./my-project.html",
  "position": [25, -10, 15],
  "color": "0xff6b9d",
  "type": "page",
  "description": "私のプロジェクト紹介"
}
```

**惑星（衛星を持つ親星）**:
```json
{
  "id": "links",
  "name": "Links",
  "url": "./links.html",
  "position": [-15, 15, 5],
  "color": "0x00ffff",
  "type": "planet",
  "description": "外部リンク一覧"
}
```

**衛星（親星の周りを回転する子星）**:
```json
{
  "id": "github",
  "name": "GitHub",
  "url": "./github.html",
  "position": [0, 0, 0],
  "color": "0xffffff",
  "type": "satellite",
  "description": "つくったもの",
  "parentId": "links",
  "orbitRadius": 12,
  "orbitSpeed": 0.5,
  "orbitAngle": 0
}
```

**注意**: 衛星の場合、`position`は使用されません（親星の位置を基準に自動計算されます）。`orbitAngle`でリング上の初期位置を指定します（0, 2.094, 4.189など、120度ずつずらすと均等に配置されます）。

### 惑星・衛星を追加する際の注意事項

#### 1. データ構造の確認
- **惑星（`type: "planet"`）**: 必ず`id`フィールドを設定し、一意のIDを使用
- **衛星（`type: "satellite"`）**: 必ず`parentId`フィールドを設定し、親星の`id`と一致させる
- 親星が存在しない場合、衛星は正しく動作しません

#### 2. 親子関係の設定
```json
// 親星（惑星）
{
  "id": "links",
  "name": "Links",
  "type": "planet",
  ...
}

// 子星（衛星）
{
  "id": "github",
  "name": "GitHub",
  "type": "satellite",
  "parentId": "links",  // 親星のidと一致させる
  ...
}
```

#### 3. 軌道パラメータの調整
- **`orbitRadius`**: 親星からの距離（デフォルト: 10）
  - 複数の衛星がある場合、内側のリングほど半径を小さくする
  - リングの`baseRadius`と`radiusDecrease`の設定を考慮する
- **`orbitSpeed`**: 回転速度（デフォルト: 0.5）
  - 大きいほど速く回転
  - 複数の衛星で異なる速度を設定すると、動きにバリエーションが出る
- **`orbitAngle`**: 初期角度（ラジアン、デフォルト: 0）
  - 複数の衛星を均等に配置する場合: `0`, `2.094` (120°), `4.189` (240°)
  - または: `0`, `1.571` (90°), `3.142` (180°), `4.712` (270°)

#### 4. リングの自動生成
- 衛星を持つ惑星には自動的にリングが追加されます
- リングの数は衛星の数と同じになります
- リングの色は対応する衛星の色で表示されます
- リングの半径は`orbitRadius`に基づいて自動計算されます

#### 5. 位置の設定
- **惑星**: `position`フィールドで3D空間内の位置を指定
- **衛星**: `position`フィールドは無視されます（親星の位置を基準に自動計算）
- 惑星の位置は、他の星や太陽と重ならないように注意

#### 6. 太陽（About）について
- 太陽は特別なオブジェクトで、`stars`配列には含まれません
- ワールド座標の中心（0, 0, 0）に固定配置
- 太陽を親星とする衛星は作成できません（実装上の制限）
- 太陽から戻る際のアニメーションは特別に処理されます

#### 7. 色の設定
- 星の色はHSL色空間で彩度が70%に下げられます（視覚的な調整）
- リングの色も同様に彩度が下げられます
- 色は16進数形式（`"0xrrggbb"`）で指定

#### 8. ページ遷移の設定
- 各星には`url`フィールドが必要です
- 内部ページ: `"./page.html"` 形式
- 外部リンク: `"https://example.com"` 形式
- 遷移先ページには「宇宙に戻る」ボタンを追加し、背景色をURLパラメータで受け取る

#### 9. テスト時の確認事項
- 親星と子星の関係が正しく設定されているか
- リングが正しく表示されているか
- 子星がリング上を正しく回転しているか
- 親星の移動にリングと子星が追従しているか
- 親星の脈動（スケール変化）がリングと子星に影響していないか
- クリック時のカメラアニメーションが正しく動作するか
- 戻りアニメーションが正しく動作するか

#### 10. よくある問題と解決方法
- **子星が表示されない**: `parentId`が親星の`id`と一致しているか確認
- **リングが表示されない**: 惑星に`type: "planet"`が設定されているか、衛星に`parentId`が設定されているか確認
- **子星の位置がおかしい**: `orbitRadius`と`orbitAngle`の値を確認
- **戻りアニメーションが動作しない**: 各ページの「宇宙に戻る」ボタンに`id="back-button"`が設定されているか、JavaScriptでリンクが正しく設定されているか確認

### 2. 遷移先ページを作成（内部ページの場合）

星をクリックした際の遷移先ページを作成します。`docs/`ディレクトリにHTMLファイルを配置します。

#### ページの基本構造

- Three.jsを使用した背景の星
- URLパラメータ `?bg=rrggbb` から背景色を取得して適用
- 「宇宙に戻る」ボタン（`./index.html`へのリンク）

既存のページ（`github.html`、`youtube.html`など）を参考にしてください。

### 3. 設定のカスタマイズ（オプション）

`docs/stars/config.json`で星システムの動作をカスタマイズできます。

#### 星タイプごとの設定

```json
"starTypes": {
  "page": {
    "size": 1.5,              // 星のサイズ
    "glowSize": 2.0,          // グロー効果のサイズ
    "glowOpacity": 0.3,       // グロー効果の透明度
    "emissiveIntensity": 0.5  // 発光の強さ
  }
}
```

#### アニメーション設定

```json
"animation": {
  "duration": 2000,           // カメラ移動の時間（ミリ秒）
  "cameraDistance": 5,        // 星への接近距離
  "scaleMultiplier": 2.0      // クリック時の拡大倍率
}
```

#### 背景の星の設定

```json
"background": {
  "starCount": 200,           // 背景の星の数
  "starSize": 0.1,            // 背景の星のサイズ
  "starOpacity": 0.5          // 背景の星の透明度
}
```

#### カメラ設定

```json
"camera": {
  "fov": 75,                  // 視野角
  "near": 0.1,                // 近接クリッピング面
  "far": 1000,                // 遠方クリッピング面
  "initialZ": 50              // 初期Z位置
}
```

#### コントロール設定

```json
"controls": {
  "enableDamping": true,      // ダンピング（慣性）を有効化
  "dampingFactor": 0.05,      // ダンピング係数
  "minDistance": 20,          // 最小ズーム距離
  "maxDistance": 200          // 最大ズーム距離
}
```

#### リング設定

```json
"rings": {
  "count": 3,                 // リングの本数（通常は衛星の数と同じ）
  "baseRadius": 8,            // 外側のリングの半径
  "width": 0.1,               // リングの太さ
  "segments": 64,             // リングの分割数（滑らかさ）
  "opacity": 0.5,             // リングの透明度
  "rotationSpeed": 0.2,       // リングの回転速度（未使用、衛星のorbitSpeedを使用）
  "radiusDecrease": 1.5       // 内側への半径の減少量
}
```

## 更新履歴

### 2024-XX-XX: Phase 1 完了
- history.md作成
- 既存システムの刷新完了
- Three.jsを使用した3D空間の実装
- 星の生成と配置システムの実装
- 星のアニメーション（回転・漂う動き・脈動）の実装
- 星のクリック検知と遷移機能の実装
- ラベル表示機能の実装
- links.htmlとnotes.htmlの刷新（背景に星を表示）

### 2024-XX-XX: データ構造の整理
- 星のデータを`stars/data.json`に分離
- 設定を`stars/config.json`に分離
- モジュール化により拡張性と再利用性を向上
- 星の追加方法をドキュメント化

### 2024-XX-XX: 衛星システムの実装
- 星を「惑星」と「衛星」に分類するシステムを実装
- 衛星が親星（惑星）の周りを回転する機能
- 衛星を持つ惑星にリングを自動追加
- リングは3本の細い線で構成され、内側ほど半径が小さくなる
- 各リングは対応する衛星の色で表示
- 子星はリング上を移動し、リングと同じ軸（Z軸）で回転
- リングと子星は親星の位置に追従し、親星の脈動（スケール変化）の影響を受けない
- 子星は`starsGroup`から分離し、`starsGroup`の回転の影響を受けないように実装

### 2024-XX-XX: 流れ星エフェクトの実装
- 非定期的に画面に流れ星が表示される機能を追加
- 3-8秒間隔でランダムに生成
- 画面の端から端へ移動するアニメーション
- 尾を引くエフェクト（20ポイントの線）
- 徐々に消えていくアニメーション
- 複数の流れ星が同時に表示される可能性がある

### 2024-XX-XX: 戻りアニメーションの実装
- 各ページから「宇宙に戻る」ボタンをクリックした際のアニメーションを追加
- カメラが星の位置から初期位置に戻るアニメーション
- 背景色が星の色から黒色に戻るアニメーション
- URLパラメータ（`?return=true&bg=色&from=ページ名`）で制御
- 各ページの「宇宙に戻る」ボタンを動的に生成し、現在の背景色をURLパラメータに追加
- 太陽（About）からの戻りアニメーションを特別に処理
- アニメーション完了後、URLパラメータを自動的にクリーンアップ

### 実装詳細
- **index.html**: メインの宇宙空間。JSONファイルから星のデータを読み込んで表示
- **星の機能**:
  - 3D空間内を自由に漂うアニメーション
  - マウスホバーでラベル表示
  - クリックでカメラアニメーション後にページ遷移
  - 星のサイズが脈動するアニメーション
  - グロー効果
  - 星の色が遷移先ページの背景色として適用される
- **背景**: 設定可能な数の小さな星で装飾
- **コントロール**: OrbitControlsでマウス操作可能（回転・ズーム）
  - 左クリック: 星の選択
  - 右クリック/中クリック: カメラの回転・ズーム
- **衛星システム**:
  - 惑星（`type: "planet"`）と衛星（`type: "satellite"`）の分類
  - 衛星は親星（惑星）の周りをリング上で回転
  - 衛星を持つ惑星には自動的にリングが追加される
  - リングは3本の細い線で構成され、内側ほど半径が小さくなる
  - 各リングは対応する衛星の色で表示される
  - リングと子星は親星を基準として同じ軸（Z軸）で回転
  - 子星は`starsGroup`から分離され、`starsGroup`の回転の影響を受けない
  - リングと子星は親星の位置に追従し、親星の脈動（スケール変化）の影響を受けない
- **流れ星エフェクト**:
  - 非定期的に画面に流れ星が表示される（3-8秒間隔でランダム）
  - 画面の端から端へ移動するアニメーション
  - 尾を引くエフェクト（20ポイントの線）
  - 徐々に消えていくアニメーション
- **戻りアニメーション**:
  - 各ページから「宇宙に戻る」ボタンをクリックすると、カメラが星の位置から初期位置に戻るアニメーション
  - 背景色が星の色から黒色に戻るアニメーション
  - URLパラメータ（`?return=true&bg=色&from=ページ名`）で制御
  - 各ページの「宇宙に戻る」ボタンは、現在の背景色を自動的にURLパラメータに追加
- **太陽（About）**:
  - ワールド座標の中心（0, 0, 0）に配置
  - 金色（`0xffd700`）で表示
  - 複数層のグロー効果
  - ゆっくりと回転し、サイズが脈動する
  - 自己紹介ページ（`sun.html`）へのリンク

